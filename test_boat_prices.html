<!DOCTYPE html>
<html>
<head>
    <title>Test Boat Pricing</title>
</head>
<body>
    <h1>Boat Pricing Test</h1>
    <div id="results"></div>

    <script type="module">
        // Import the booking helpers
        const calculatePrice = (categoryId, basePrice, params = {}) => {
            const { boatDuration, listing } = params;
            
            if (categoryId === 4 && listing) {
                // Parse duration to hours
                let hours = 1;
                if (boatDuration) {
                    if (typeof boatDuration === 'string') {
                        if (boatDuration.includes('min')) {
                            const minutes = parseFloat(boatDuration.replace('min', ''));
                            hours = minutes / 60;
                        } else if (boatDuration.includes('h')) {
                            hours = parseFloat(boatDuration.replace('h', ''));
                        } else {
                            // Handle plain numbers like "3" or "5.5"
                            hours = parseFloat(boatDuration);
                        }
                    } else if (typeof boatDuration === 'number') {
                        hours = boatDuration;
                    }
                }
                
                // Apply exact hour range pricing
                let price = 0;
                if (hours >= 0.5 && hours <= 1.5) {
                    // 30min to 1.5 hours: price_per_hour * hours
                    price = (listing.price_per_hour || basePrice) * hours;
                } else if (hours >= 2 && hours <= 4) {
                    // 2 to 4 hours: use flat half-day rate
                    price = listing.price_per_half_day || listing.price_per_hour * 4;
                } else if (hours >= 4.5 && hours <= 8) {
                    // 4.5 to 8 hours: use flat full-day rate
                    price = listing.price_per_day || listing.price_per_hour * 8;
                } else {
                    // Invalid duration - use hourly rate as fallback
                    price = (listing.price_per_hour || basePrice) * hours;
                }
                
                return Math.round(price * 100) / 100;
            }
            return basePrice;
        };

        // Test data - matching the test-boat listing
        const testListing = {
            price_per_hour: 12,
            price_per_half_day: 34,
            price_per_day: 56
        };

        // Test different durations
        const testCases = [
            { duration: 0.5, expected: 6, description: "30 minutes (hourly rate)" },
            { duration: 1, expected: 12, description: "1 hour (hourly rate)" },
            { duration: 1.5, expected: 18, description: "1.5 hours (hourly rate)" },
            { duration: 2, expected: 34, description: "2 hours (half-day flat rate)" },
            { duration: 3, expected: 34, description: "3 hours (half-day flat rate)" },
            { duration: 4, expected: 34, description: "4 hours (half-day flat rate)" },
            { duration: 4.5, expected: 56, description: "4.5 hours (full-day flat rate)" },
            { duration: 5.5, expected: 56, description: "5.5 hours (full-day flat rate)" },
            { duration: 8, expected: 56, description: "8 hours (full-day flat rate)" }
        ];

        let results = '<table border="1" cellpadding="5">';
        results += '<tr><th>Duration</th><th>Description</th><th>Expected</th><th>Calculated</th><th>Status</th></tr>';

        testCases.forEach(test => {
            const calculated = calculatePrice(4, 12, {
                boatDuration: test.duration,
                listing: testListing
            });
            
            const status = calculated === test.expected ? '✅ PASS' : '❌ FAIL';
            const style = calculated === test.expected ? 'color: green' : 'color: red';
            
            results += `<tr style="${style}">
                <td>${test.duration} hours</td>
                <td>${test.description}</td>
                <td>€${test.expected}</td>
                <td>€${calculated}</td>
                <td>${status}</td>
            </tr>`;
        });

        results += '</table>';
        document.getElementById('results').innerHTML = results;
    </script>
</body>
</html>